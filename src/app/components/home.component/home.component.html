<!-- Modal para a침adir evento -->
<div *ngIf="showModalAddEvento" class="modal-overlay" (click)="cerrarModalAddEvento()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
        <i class="bi bi-calendar-plus"></i>
      </div>
      <button class="modal-close" (click)="cerrarModalAddEvento()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="modal-body">
      <h2>Crear nuevo evento</h2>
      <p class="mb-3">Selecciona la fecha y hora del evento:</p>
      <div class="date-picker-container">
        <label for="fechaEvento" class="date-label">
          <i class="bi bi-calendar3 me-2"></i>Fecha y hora
        </label>
        <input 
          type="datetime-local" 
          id="fechaEvento"
          class="date-input"
          [ngModel]="fechaSeleccionadaLocal"
          (ngModelChange)="onFechaChange($event)"
        />
      </div>
      
      <div style="margin-top: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
          <i class="bi bi-person-badge"></i> Asignar profesor (opcional)
        </label>
        <select 
          [(ngModel)]="idProfesorNuevoEvento"
          class="form-control"
          style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; width: 100%; font-size: 14px;"
        >
          <option [value]="null">Sin profesor asignado</option>
          <option *ngFor="let profesor of profesoresActivos" [value]="profesor.idUsuario">
            {{ profesor.usuario }} - {{ profesor.email }}
          </option>
        </select>
        <small style="color: #6b7280; margin-top: 5px; display: block;">
          {{ profesoresActivos.length }} profesores disponibles
        </small>
      </div>
    </div>
  @if(this.fechaSeleccionada! < now){
    <div class="modal-warning">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      <span>No se puede a침adir un evento en el pasado.</span>
    </div>
    }
    <div class="modal-footer">
      <button class="btn-modal-cancel" (click)="cerrarModalAddEvento()">
        Cancelar
      </button>
      <button class="btn-modal-confirm" (click)="confirmarAddEvento()" [disabled]="!fechaSeleccionada || fechaSeleccionada < now">
        <i class="bi bi-calendar-plus"></i>
        A침adir evento
      </button>
    </div>
  </div>
</div>

<!-- Modal para cancelar evento -->
<div *ngIf="showModalCancelEvento" class="modal-overlay" (click)="cerrarModalCancelEvento()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon" style="background: linear-gradient(135deg, #ef4444 0%, #f59e42 100%);">
        <i class="bi bi-calendar-x"></i>
      </div>
      <button class="modal-close" (click)="cerrarModalCancelEvento()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="modal-body">
      <h2>쮺ancelar este evento?</h2>
      <p>Evento #{{eventoSeleccionado?.idEvento}}<br>
         Fecha: <b>{{eventoSeleccionado?.fechaEvento | date:'fullDate'}}</b></p>
    </div>
    @if(eventoSeleccionado?.fechaEvento < now){
    <div class="modal-warning">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      <span>No se puede cancelar un evento que ya ha pasado.</span>
    </div>
    }
    <div class="modal-footer">
      <button class="btn-modal-cancel" (click)="cerrarModalCancelEvento()">
        No cancelar
      </button>
      <button class="btn-modal-confirm" (click)="confirmarCancelEvento()">
        <i class="bi bi-calendar-x"></i>
        Cancelar evento
      </button>
    </div>
  </div>
</div>

<!-- Modal para editar evento -->
<div *ngIf="showModalEditarEvento" class="modal-overlay" (click)="cerrarModalEditarEvento()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
        <i class="bi bi-pencil"></i>
      </div>
      <button class="modal-close" (click)="cerrarModalEditarEvento()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="modal-body">
      <h2>Gestionar Evento</h2>
      <p class="text-muted" style="margin-bottom: 20px;">Evento #{{eventoSeleccionado?.idEvento}}</p>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
          <i class="bi bi-calendar3"></i> Fecha del evento
        </label>
        <input 
          type="date" 
          [(ngModel)]="fechaEditar"
          class="form-control"
          style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; width: 100%; font-size: 14px;"
        />
      </div>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
          <i class="bi bi-person-badge"></i> Profesor asignado
        </label>
        <select 
          [(ngModel)]="idProfesorEditar"
          class="form-control"
          style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; width: 100%; font-size: 14px;"
        >
          <option [value]="null">Sin profesor asignado</option>
          <option *ngFor="let profesor of profesoresActivos" [value]="profesor.idUsuario">
            {{ profesor.usuario }} - {{ profesor.email }}
          </option>
        </select>
        <small style="color: #6b7280; margin-top: 5px; display: block;">
          {{ profesoresActivos.length }} profesores disponibles
        </small>
      </div>

      <button class="btn-eliminar-actividad" (click)="abrirModalEliminarEvento()" style="margin-top: 10px;">
        <i class="bi bi-trash3"></i>
        Eliminar evento
      </button>
    </div>
    <div class="modal-footer">
      <button class="btn-modal-cancel" (click)="cerrarModalEditarEvento()">
        Cancelar
      </button>
      <button class="btn-modal-confirm" (click)="guardarCambiosEvento()">
        <i class="bi bi-check-circle"></i>
        Guardar cambios
      </button>
    </div>
  </div>
</div>

<!-- Modal confirmaci칩n eliminar evento -->
<div *ngIf="showModalEliminarEvento" class="modal-overlay" (click)="cerrarModalEliminarEvento()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
        <i class="bi bi-exclamation-triangle-fill"></i>
      </div>
      <button class="modal-close" (click)="cerrarModalEliminarEvento()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="modal-body">
      <h2>쮼liminar evento completo?</h2>
      <p><strong>Evento #{{eventoSeleccionado?.idEvento}}</strong></p>
      <p>Fecha: {{eventoSeleccionado?.fechaEvento | date:'fullDate'}}</p>
      <p class="text-warning">丘멆잺 Esta acci칩n no se puede deshacer</p>
      <p class="text-muted">Se eliminar치n TODAS las actividades, equipos, miembros e inscripciones asociadas a este evento.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-modal-cancel" (click)="cerrarModalEliminarEvento()">
        Cancelar
      </button>
      <button class="btn-modal-confirm btn-modal-danger" (click)="confirmarEliminarEvento()">
        <i class="bi bi-trash3"></i>
        Eliminar Evento
      </button>
    </div>
  </div>
</div>

<!-- Modal de error -->
<div *ngIf="showModalError" class="modal-overlay" (click)="cerrarModalError()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
        <i class="bi bi-x-circle-fill"></i>
      </div>
      <button class="modal-close" (click)="cerrarModalError()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="modal-body">
      <h2>Error</h2>
      <p>{{mensajeError}}</p>
    </div>
    <div class="modal-footer">
      <button class="btn-modal-confirm btn-full" (click)="cerrarModalError()">
        Aceptar
      </button>
    </div>
  </div>
</div>

<div class="container-fluid main-container p-4">

  <!-- Welcome Header -->
  <div class="welcome-section mb-4">
    <div class="welcome-header">
      <h1 class="welcome-title">
        Hola, <span class="user-highlight">{{perfil.nombre}}</span>! 游녦
      </h1>
      <p class="welcome-subtitle">Gestiona tus eventos y actividades</p>
    </div>
  
  
  </div>

  <!-- Two Column Layout (Top) + Calendar (Bottom) -->
  <div class="professional-layout">
       @if(authservices.isAdmin()){
     <button class="btn-crear-evento" (click)="abrirModalCrearEvento()">
      <i class="bi bi-plus-circle me-2"></i>
      Crear Evento
    </button>
     }
    <!-- TOP ROW: Events and Activities -->
    <div class="top-row">
      
      <!-- LEFT: Events List -->
      <aside class="events-column">
        <div class="card-container">
          <div class="card-header">
            <div class="d-flex align-items-center">
              <div class="icon-box me-3 bg-accent text-white">
                <i class="bi bi-calendar-event"></i>
              </div>
              <h2 class="card-title mb-0">Eventos</h2>
            </div>
          </div>

          <!-- Tabs for Upcoming/Past Events -->
          <div class="event-tabs">
            <button class="tab-btn active" onclick="this.classList.add('active'); this.nextElementSibling.classList.remove('active'); document.getElementById('upcoming').style.display='block'; document.getElementById('past').style.display='none';">
              <i class="bi bi-calendar-check me-2"></i>Pr칩ximos
            </button>
            <button class="tab-btn" onclick="this.classList.add('active'); this.previousElementSibling.classList.remove('active'); document.getElementById('upcoming').style.display='none'; document.getElementById('past').style.display='block';">
              <i class="bi bi-calendar-x me-2"></i>Finalizados
            </button>
          </div>

          <!-- Upcoming Events -->
          <div id="upcoming" class="events-scroll-area">
            <ng-container *ngFor="let event of eventos">
              <div *ngIf="event.fechaEvento >= now" class="event-card" (click)="onclickEvento(event.idEvento)" [class.active]="idEvento === event.idEvento">
                <div class="event-date">
                  <span class="date-day">{{ event.fechaEvento | date:'dd' }}</span>
                  <span class="date-month">{{ event.fechaEvento | date:'MMM' | uppercase }}</span>
                </div>
                <div class="event-info">
                  <div class="event-time">
                    <i class="bi bi-clock me-2"></i>
                    {{ event.fechaEvento | date:'HH:mm' }}h
                  </div>
                  <div class="event-id">#{{event.idEvento}}</div>
                </div>
                <button *ngIf="authservices.isAdmin() && this" class="btn-edit-event" (click)="abrirModalEditarEvento($event, event)" title="Editar evento">
                  <i class="bi bi-pencil-square"></i>
                </button>
              </div>
            </ng-container>
          </div>

          <!-- Past Events -->
          <div id="past" class="events-scroll-area" style="display: none;">
            <ng-container *ngFor="let event of eventos">
              <div *ngIf="event.fechaEvento < now" class="event-card past" (click)="onclickEvento(event.idEvento)" [class.active]="idEvento === event.idEvento">
                <div class="event-date">
                  <span class="date-day">{{ event.fechaEvento | date:'dd' }}</span>
                  <span class="date-month">{{ event.fechaEvento | date:'MMM' | uppercase }}</span>
                </div>
                <div class="event-info">
                  <div class="event-time">
                    <i class="bi bi-clock me-2"></i>
                    {{ event.fechaEvento | date:'HH:mm' }}h
                  </div>
                  <div class="event-id">#{{event.idEvento}}</div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </aside>

      <!-- RIGHT: Activities -->
      <section class="activities-column">
        <div class="card-container activities-card">
          <div class="card-header">
            <div class="d-flex align-items-center">
              <div class="icon-box me-3 bg-success text-white">
                <i class="bi bi-list-check"></i>
              </div>
              <h2 class="card-title mb-0">Actividades</h2>
            </div>
          </div>
          <div class="activities-content">
            <ng-container *ngIf="idEvento != null; else placeholder">
              <app-actividades [idEvento]="idEvento"></app-actividades>
            </ng-container>
            <ng-template #placeholder>
              <div class="empty-state">
                <i class="bi bi-hand-index fs-1 mb-3"></i>
                <h4>Selecciona un evento</h4>
                <p class="muted">Haz clic en un evento de la izquierda para ver sus actividades</p>
              </div>
            </ng-template>
          </div>
        </div>
      </section>

    </div>

    <!-- BOTTOM ROW: Calendar (Full Width) -->
    <div class="calendar-row">
      <div class="card-container">
        <div class="card-header">
          <div class="d-flex align-items-center">
            <div class="icon-box me-3 bg-warning text-white">
              <i class="bi bi-calendar3"></i>
            </div>
            <h2 class="card-title mb-0">Calendario</h2>
          </div>
        </div>
        <div class="calendar-content">
          <full-calendar [options]="calendarOptions"></full-calendar>
        </div>
      </div>
    </div>

  </div>

</div>
